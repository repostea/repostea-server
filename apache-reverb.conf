# =============================================================================
# APACHE REVERB WEBSOCKET CONFIGURATION
# =============================================================================
#
# STEP 1: Enable required Apache modules
# --------------------------------------
# sudo a2enmod proxy proxy_http proxy_wstunnel rewrite
# sudo systemctl restart apache2
#
# STEP 2: Add the proxy config to your VirtualHost
# -------------------------------------------------
#
# For PRODUCTION (api.renegados.es) - Reverb port 8080
# For STAGING (pre-api.renegados.es) - Reverb port 8081
#
# =============================================================================

# -----------------------------------------------------------------------------
# STAGING - Add inside <VirtualHost *:443> of pre-api.renegados.es.conf
# -----------------------------------------------------------------------------
#
#     # Reverb WebSocket Proxy
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     # WebSocket upgrade for /app path
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} websocket [NC]
#     RewriteCond %{HTTP:Connection} upgrade [NC]
#     RewriteRule ^/app/(.*)$ ws://127.0.0.1:8081/app/$1 [P,L]
#
#     # Regular HTTP requests to /app
#     ProxyPass /app http://127.0.0.1:8081/app
#     ProxyPassReverse /app http://127.0.0.1:8081/app
#
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# PRODUCTION - Add inside <VirtualHost *:443> of api.renegados.es.conf
# -----------------------------------------------------------------------------
#
#     # Reverb WebSocket Proxy
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     # WebSocket upgrade for /app path
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} websocket [NC]
#     RewriteCond %{HTTP:Connection} upgrade [NC]
#     RewriteRule ^/app/(.*)$ ws://127.0.0.1:8080/app/$1 [P,L]
#
#     # Regular HTTP requests to /app
#     ProxyPass /app http://127.0.0.1:8080/app
#     ProxyPassReverse /app http://127.0.0.1:8080/app
#
# -----------------------------------------------------------------------------

# =============================================================================
# COMPLETE EXAMPLE: pre-api.renegados.es.conf with WebSocket support
# =============================================================================
#
# <VirtualHost *:443>
#     ServerAlias pre-api.renegados.es
#
#     DocumentRoot /var/www/repostea-staging/server/public
#
#     <Directory /var/www/repostea-staging/server/public>
#         AllowOverride All
#         Require all granted
#         Options -Indexes +FollowSymLinks
#     </Directory>
#
#     # Reverb WebSocket Proxy
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} websocket [NC]
#     RewriteCond %{HTTP:Connection} upgrade [NC]
#     RewriteRule ^/app/(.*)$ ws://127.0.0.1:8081/app/$1 [P,L]
#
#     ProxyPass /app http://127.0.0.1:8081/app
#     ProxyPassReverse /app http://127.0.0.1:8081/app
#
#     ErrorLog ${APACHE_LOG_DIR}/pre-api_error.log
#     CustomLog ${APACHE_LOG_DIR}/pre-api_access.log combined
#
#     SSLCertificateFile /etc/letsencrypt/live/pre-api.renegados.es/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/pre-api.renegados.es/privkey.pem
#     Include /etc/letsencrypt/options-ssl-apache.conf
# </VirtualHost>
#
